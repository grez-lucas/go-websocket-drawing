<!doctype html>
<html>
  <head>
    <title>Simple Drawing Board</title>
    <style>
      body {
        margin: 0;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="drawingCanvas"></canvas>

    <script>
      const canvas = document.getElementById("drawingCanvas");
      const ctx = canvas.getContext("2d");
      let drawing = false;
      let lastX = 0;
      let lastY = 0;
      const websocket = new WebSocket("ws://localhost:8000/ws");

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      websocket.onopen = () => {
        console.log("WebSocket connection established.");
      };

      websocket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        drawLine(data.startX, data.startY, data.endX, data.endY);
      };

      websocket.onclose = () => {
        console.log("WebSocket connection closed.");
      };

      canvas.addEventListener("mousedown", (e) => {
        drawing = true;
        lastX = e.offsetX;
        lastY = e.offsetY;
      });

      canvas.addEventListener("mousemove", (e) => {
        if (!drawing) return;
        const currentX = e.offsetX;
        const currentY = e.offsetY;
        sendDrawingData(lastX, lastY, currentX, currentY);
        lastX = currentX;
        lastY = currentY;
      });

      canvas.addEventListener("mouseup", () => {
        drawing = false;
      });

      canvas.addEventListener("mouseout", () => {
        drawing = false;
      });

      function drawLine(startX, startY, endX, endY) {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.stroke();
      }

      function sendDrawingData(startX, startY, endX, endY) {
        const data = JSON.stringify({ startX, startY, endX, endY });
        websocket.send(data);
      }
    </script>
  </body>
</html>
